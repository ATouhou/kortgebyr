<!DOCTYPE HTML>
<html><head>
   <title>Kortgebyr - sammenlign betalingsløsninger</title>
   <meta name="description" content="Sammenlign priser på betalingsløsninger. Find den billigste betalingsløsning og udregn det samlede kortgebyr.">
   <link rel="canonical" href="https://kortgebyr.dk">
   <style>img {
  box-sizing: content-box;
  border: 0px;
}
a:active,
a:hover,
:focus {
  outline: 0;
  outline-color: transparent;
  outline-style: none;
}
input,
button,
select {
  font-family: inherit;
  color: inherit;
}
.hidden {
  display: none !important;
  visibility: hidden;
}
.clearfix:before,
.clearfix:after {
  content: " ";
  display: table;
}
.clearfix:after {
  clear: both;
}
img,
svg {
  vertical-align: middle;
}
.noselect,
.menulist {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
@font-face {
  font-family: 'SSP';
  font-weight: 400;
  font-style: normal;
  src: url("/assets/fonts/SSP/regular.woff2") format('woff2'), url("/assets/fonts/SSP/regular.woff") format('woff');
}
@font-face {
  font-family: 'SSP';
  font-weight: 600;
  font-style: normal;
  src: url("/assets/fonts/SSP/semibold.woff2") format('woff2'), url("/assets/fonts/SSP/semibold.woff") format('woff');
}
html {
  font-family: 'SSP', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  /* 1 */
  font-size: 15px;
  line-height: 1.5;
  color: #2c2c2c;
  position: relative;
  box-sizing: border-box;
  height: 100%;
  overflow: auto;
}
body {
  background: #fff;
  height: 100%;
  overflow: auto;
}
*,
*:before,
*:after {
  margin: 0;
  padding: 0;
  border: 0;
  box-sizing: inherit;
}
a {
  color: #36b;
  text-decoration: none;
}
.c {
  width: 97%;
  max-width: 1040px;
  min-width: 860px;
  margin: auto;
  position: relative;
}
header {
  display: block;
  margin-top: 15px !important;
  border: 1px solid #dbdbdb;
}
nav {
  font-size: 14px;
  border-bottom: 1px solid #ddd;
  height: 43px;
  line-height: 41px;
  background-color: #f5f5f5;
  overflow: hidden;
}
nav .logo {
  float: left;
}
nav .logo a {
  margin-left: 20px;
  color: #204499;
  font-size: 20px;
  font-family: "Trebuchet MS", Helvetica, sans-serif;
  font-weight: bold;
  text-shadow: #fff 0px 1px 1px;
  -webkit-font-smoothing: antialiased;
  -moz-font-smoothing: antialiased;
  -ms-font-smoothing: antialiased;
  font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}
nav .logo a:hover {
  color: #3E79BB;
}
nav .contact {
  float: right;
  margin-right: 18px;
  line-height: 43px;
}
nav .language,
nav .currency {
  float: right;
  height: 100%;
  border-left: 1px solid #ddd;
  cursor: pointer;
  line-height: 43px;
}
nav .language:after,
nav .currency:after {
  content: "";
  position: absolute;
  top: 20px;
  right: 10px;
  width: 0;
  height: 0;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid #bbb;
}
nav .language:hover:after,
nav .currency:hover:after {
  border-top-color: #999;
}
nav .language:hover,
nav .currency:hover {
  background-color: #e9e9e9;
}
nav .currency {
  width: 62px;
  position: relative;
}
nav .currency label {
  padding-left: 10px;
}
nav .currency select {
  opacity: 0;
  z-index: 10;
  position: absolute;
  right: 0;
  left: 0;
  bottom: 0;
  top: 0;
  width: 100%;
  height: 100%;
  font-size: 13px;
  cursor: pointer;
}
nav .language {
  width: 56px;
}
nav .language img {
  margin: 0px 0 0 11px;
}
nav .lastUpdate {
  float: left;
  margin: 3px 0 0 7px;
}
.menu {
  font-size: 14px;
}
.menu section {
  display: block;
  width: 32%;
  float: left;
  padding: 6px 0 5px 3%;
  margin: 11px 0;
}
.menu label {
  display: table;
  margin: 5px 0;
  line-height: 22px;
}
.menu input {
  margin-right: 5px;
}
.menu .acquirer_menu {
  padding-left: 22px;
  padding-right: 25px;
}
.menu h2 {
  font-size: 24px;
  color: #444;
  font-family: "Trebuchet MS", Helvetica, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-font-smoothing: antialiased;
  -ms-font-smoothing: antialiased;
  font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}
.menu .field {
  width: 65px;
  margin: 4px 7px 5px 0;
  padding-left: 4px;
  font-size: 15px;
  line-height: 24px;
  height: 26px;
  color: #555;
  border-radius: 3px;
  background-color: #fff;
  border: 1px solid #bbb;
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  transition: border linear 0.2s, box-shadow linear 0.2s;
}
.menu .acquirer_field {
  width: 100%;
}
.menu .acquirer_field select {
  display: block;
  font-weight: 600;
  width: 100%;
  height: 30px;
  padding: 0 5px;
  margin-bottom: 13px;
  font-size: 14px;
  color: #666;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-weight: 400;
  background: #FDFDFD;
}
.menu .acquirer_description {
  font-size: 14px;
  margin-top: 16px;
}
.menu h2 {
  font-size: 15px;
  margin-bottom: 7px;
}
.table {
  background: #fff;
  border-collapse: separate;
  border-spacing: 0;
  border: 1px solid #d9d9d9;
  border-left: 0;
  font-weight: 400;
  font-size: 14px;
  color: #444;
  empty-cells: show;
  margin-top: 18px;
}
.table td,
.table th {
  text-align: center;
  position: relative;
  border-left: 1px solid #dcdcdc;
  border-top: 1px solid #dcdcdc;
  padding: 10px 0 7px;
}
.table th {
  padding: 5px 0 4px;
  font-size: 13px;
  line-height: 16px;
  font-weight: 600;
  background-color: #f5f5f5;
  border-top: 0;
  color: #444;
  -webkit-font-smoothing: antialiased;
  -moz-font-smoothing: antialiased;
  -ms-font-smoothing: antialiased;
  font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  overflow: hidden;
}
.table td:first-child {
  padding-left: 1.5%;
  text-align: left;
}
.table td:nth-child(3) {
  padding-right: 13px;
  padding-left: 13px;
}
.psp {
  font-size: 12px;
  display: block;
}
.psp img {
  display: inline;
  text-align: left;
  margin: 6px 0 0;
  height: 31px;
  max-width: 135px;
}
.psp p {
  padding: 2px 0 1px;
}
.acquirer {
  position: relative;
  margin: 1px 0 3px;
}
.acquirer .clearhaus,
.acquirer .nets,
.acquirer .elavon {
  height: 13px;
}
.acquirer .teller {
  height: 10.4px;
}
.acquirer .handelsbanken {
  width: 80px;
}
.card {
  display: inline-block;
  width: 22px;
  height: 15px;
  position: relative;
  margin: 4px 3px;
  vertical-align: middle;
}
.card svg {
  display: block;
  width: 100%;
  height: 100%;
}
.equal {
  font-size: 20px;
  position: absolute;
  top: 0;
  bottom: 0;
  z-index: 99;
}
.equal .icon {
  position: relative;
  margin-top: 18px;
  height: 7px;
  background: #F5F5F5;
  width: 6px;
}
.equal .icon:before,
.equal .icon:after {
  display: block;
  content: "";
  width: 100%;
  height: 2px;
  background: #9f9f9f;
}
.equal .icon:after {
  margin-top: 3px;
}
.equal.right {
  right: 0;
}
.equal.left {
  left: 0;
  border-left: 1px solid #dcdcdc;
}
.equal.left .icon {
  margin-left: -1px;
  width: 7px;
}
.infobutton {
  display: inline-block;
  background: #0097cf;
  padding: 0px 4px;
  border-radius: 2px;
  color: white;
  cursor: pointer;
}
.kortgebyr,
.procent {
  line-height: 19px;
}
.kortgebyr {
  margin-top: 4px;
}
.procent {
  word-spacing: -1px;
  color: #9f9f9f;
  font-size: 12px;
}
.overlay {
  display: none;
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
  z-index: 1000;
  overflow-x: auto;
  width: 100%;
  height: 100%;
  /* Fade modal background */
}
.overlay::before {
  position: absolute;
  content: "";
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: gray;
  opacity: 0.7;
  overflow: visible;
}
.overlay.active {
  display: block;
}
.modal {
  display: block;
  background: #fff;
  border-radius: 5px;
  margin: 0 auto;
  padding: 40px;
  position: absolute;
  left: 50%;
  top: 45%;
  transform: translate(-50%, -50%);
}
.modal .part {
  display: none;
}
.modal .part.active {
  display: block;
}
.modal .cross {
  font: normal normal normal 2em / normal Arial, Helvetica, sans-serif;
  width: 0.75em;
  height: 0.75em;
}
.modal .cross:before {
  display: inline-block;
  width: 0.45em;
  height: 0.1em;
  position: absolute;
  content: "";
  top: 0.33em;
  left: 0.155em;
  font: normal normal normal 100% / normal Arial, Helvetica, sans-serif;
  background: #fff;
  -webkit-transform: rotateZ(45deg) scaleX(1) scaleY(1) scaleZ(1);
  transform: rotateZ(45deg) scaleX(1) scaleY(1) scaleZ(1);
  -webkit-transform-origin: 50% 50% 0;
  transform-origin: 50% 50% 0;
}
.modal .cross:after {
  display: inline-block;
  width: 0.45em;
  height: 0.1em;
  position: absolute;
  content: "";
  top: 0.33em;
  left: 0.155em;
  font: normal normal normal 100% / normal Arial, Helvetica, sans-serif;
  background: #fff;
  -webkit-transform: rotateZ(-45deg) scaleX(1) scaleY(1) scaleZ(1);
  transform: rotateZ(-45deg) scaleX(1) scaleY(1) scaleZ(1);
  -webkit-transform-origin: 50% 50% 0;
  transform-origin: 50% 50% 0;
}
.modal .costblock {
  margin-top: 10px;
}
.modal .exit {
  width: 0.75em;
  height: 0.75em;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  z-index: 1;
  display: inline-block;
  position: absolute;
  cursor: pointer;
  top: 4px;
  right: 4px;
  -webkit-border-radius: 1em;
  border-radius: 1em;
  font: normal normal normal 2em / normal Arial, Helvetica, sans-serif;
  background: #0092d2;
}
.modal .exit:before {
  display: inline-block;
  width: 0.45em;
  height: 0.1em;
  position: absolute;
  content: "";
  top: 0.33em;
  left: 0.155em;
  font: normal normal normal 100% / normal Arial, Helvetica, sans-serif;
  background: #fff;
  -webkit-transform: rotateZ(45deg) scaleX(1) scaleY(1) scaleZ(1);
  transform: rotateZ(45deg) scaleX(1) scaleY(1) scaleZ(1);
  -webkit-transform-origin: 50% 50% 0;
  transform-origin: 50% 50% 0;
}
.modal .exit:after {
  display: inline-block;
  width: 0.45em;
  height: 0.1em;
  position: absolute;
  content: "";
  top: 0.33em;
  left: 0.155em;
  font: normal normal normal 100% / normal Arial, Helvetica, sans-serif;
  background: #fff;
  -webkit-transform: rotateZ(-45deg) scaleX(1) scaleY(1) scaleZ(1);
  transform: rotateZ(-45deg) scaleX(1) scaleY(1) scaleZ(1);
  -webkit-transform-origin: 50% 50% 0;
  transform-origin: 50% 50% 0;
}
.modal hr {
  display: block;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
  margin-left: auto;
  margin-right: auto;
  border-style: inset;
  border-top: 1px #e0e0e0 solid;
}
footer {
  background: #fff;
  text-align: center;
  padding: 34px 0 44px;
  color: #777;
  line-height: 24px;
  font-size: 14px;
}
@media screen and (max-width: 600px) {
  .modal {
    position: absolute;
    width: 100% !important;
    padding: 5%;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    transform: none;
    border-radius: 0;
  }
}
</style>
</head>
<body>
   <header class="c">
      <nav role="navigation">

         <div class="logo"><a href="/">kortgebyr</a></div>
         <div class=lastUpdate><a href="https://github.com/ulrikmoe/kortgebyr/commits/master">Opdateret d. 25. oktober 2015</a></div>

         <div class="language" onclick="alert('Denne funktion er midlertidigt disabled.')">
            <img width="19" src="/assets/img/dk.png" alt="kortgebyr på dansk" />
         </div>
         <div id="currency" class="currency">
            <label>
               <span id="currency_code">DKK</span>
               <select id="currency_code_select" onchange="changeCurrency(this)">
                  <option value="DKK">DKK</option>
                  <option value="SEK">SEK</option>
                  <option value="NOK">NOK</option>
                  <option value="USD">USD</option>
                  <option value="EUR">EUR</option>
               </select>
            </label>
         </div>
         <div class="contact"> <a href="mailto:ulrik.moe@gmail.com?Subject=Kortgebyr.dk">Feedback</a></div>
      </nav>

      <div class="menu clearfix">
         <section class="acquirer_menu">
            <h2>Indløsning</h2>
            <div class="acquirer_field">
               <select id="acquirer">
                  <option value="auto">Billigst mulige</option>
                  <option value="teller">Teller</option>
                  <option value="handelsbanken">Handelsbanken</option>
                  <option value="swedbank">Swedbank</option>
                  <option value="valitor">Valitor</option>
                  <option value="elavon">Elavon</option>
                  <option value="clearhaus">Clearhaus</option>
               </select>
            </div>
            <div class="acquirer_description">Alle priser tager udgangspunkt i listepriser. Vi anbefaler at du starter med at læse vores <a href="/forklaring.html">forklaring</a>.</div>
         </section>

         <section class="menulist" style="border-left: 1px solid #dfdfdf; border-right: 1px solid #dfdfdf;">
            <label><input autocomplete="off" type="text" class="field" id="transactions" value="250"> Transaktioner pr. måned</label>
            <label><input autocomplete="off" type="text" class="field" id="avgvalue" value="450 DKK"> Gennemsnits ordreværdi:</label>
            <label><input type="checkbox" class="ofeatures" id="antifraud" /> Svindelkontrol</label>
            <label><input type="checkbox" class="ofeatures" id="recurring" /> Abonnementsbetalinger</label>
            <label><input type="checkbox" class="ofeatures" id="multiacquirer" /> Multi-indløser</label>
         </section>
         <section class="menulist" style="width:19%">
            <label><input checked="" type="checkbox" class="ocards" id="dankort" /> Dankort</label>
            <label><input checked="" type="checkbox" class="ocards" id="visa" /> Visa / MasterCard</label>
            <label><input type="checkbox" class="ocards" id="forbrugsforeningen" /> Forbrugsforening</label>
            <label><input type="checkbox" class="ocards" id="diners" /> Diners</label>
            <label><input type="checkbox" class="ocards" id="amex" /> American Express</label>
         </section>


         <section class="menulist" style="width: 17%; border-left:0; padding-left:0; padding-right:0">
            <label><input type="checkbox" class="ocards" id="jcb" /> JCB</label>
            <label><input type="checkbox" class="ocards" id="unionpay" /> UnionPay</label>
            <label><input type="checkbox" class="ocards" id="mobilepay" /> MobilePay</label>
         </section>
      </div>
   </header>
   <main role="main">
      <table id="table" class="table c">
         <thead>
            <tr>
               <th width="174" style="text-align:left; padding-left: 1.5%;">Betalingsløsning</th>
               <th width="120">Indløsere</th>
               <th width="140">Betalingsmidler</th>
               <th>Oprettelse</th>
               <th>Abonnement</th>
               <th>
                  <div class="equal right"><p class="icon"></p></div>
                  Samlet pr. <br> måned
               </th>
               <th style="border-left:0;">
                  <div class="equal left"><p class="icon"></p></div>
                  Samlet pr. <br> transaktion
               </th>
               <th width="96"></th>
            </tr>
         </thead>
         <tbody id="tbody"></tbody>
      </table>
   </main>

   <div class="overlay pspinfo">
     <div class="modal" style="width:600px;">
       <button class="exit" onclick="this.parentNode.parentNode.classList.remove('active')"></button>
       <div class="content">
       </div>
     </div>
   </div>

   <footer>
      Kortgebyr er udviklet af <a href="https://github.com/ulrikmoe">Ulrik Moe</a>, <a href="https://github.com/cblach">Christian Blach</a> og <a href="https://github.com/zhasha">Joakim Sindholt</a> som et værktøj <br /> til at sammenligne betalingsløsninger. Kortgebyr er uafhængig, non-profit og <a href="https://github.com/ulrikmoe/kortgebyr">open source</a> (<small><a href="https://github.com/ulrikmoe/kortgebyr/blob/master/GPLv3.md">GPLv3</a></small>).
   </footer>

   <svg class="hidden" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <symbol id="dankortlogo" width="22" viewBox="0 0 70 48">
         <path d="M38 27c-2 11-7 12-17 12H0v3c0 3 3 6 6 6h58c3 0 6-3 6-6v-3H48L38 27zm21-3l11 13V11L59 24zm-20-3l9-12h22V6c0-3-3-6-6-6H6C3 0 0 3 0 6v3h24c8 0 14 4 15 12zM9 18L7 29h12c.08 0 4 0 5-5 1-6-4-6-4-6H9z" fill="#EA292B" />
      </symbol>

      <symbol id="visalogo" width="22" viewBox="0 0 70 48">
         <path d="M55.5 19.5l1.5 7h-4.5l3-7zM54 15l-8 18h4l1.5-3.5H57l1 3.5h4l-4-18h-4zm-6 0h-7c-2 .5-5 3.012-5 6 0 2.5 1.5 3.043 3 4 1.5.957 2 1 2 2.5S38 30 34 30v3c11 0 11-2 11-6 0-3-5-4-5-6 0-3 4-3 8-3v-3zM26 33l4-18h4l-4 18h-4zm-4-18l-4 14-3.5-14H10l5.5 18h5L26 15h-4z" fill="#005197"/><path d="M0 10V5c0-3 2-5 5-5h60c3 0 5 2 5 5v5H0z" fill="#0A5395"/><path d="M70 38v5c0 3-2 5-5 5H5c-3 0-5-2-5-5v-5h70z" fill="#F3A527"/>
      </symbol>

      <symbol id="mastercardlogo" width="22" viewBox="0 0 70 48">
         <rect fill="#272D67" width="70" height="48" rx="5"/><circle fill="#EA2B2C" cx="24" cy="24" r="15"/><circle fill="#FBA81F" cx="46" cy="24" r="15"/><path d="M27 28.5h10v3H27v-3zm1-6h10v3H28v-3zm-1-6h10v3H27v-3z" fill="#EA2B2C"/>
      </symbol>

      <symbol id="maestrologo" width="22" viewBox="0 0 70 48">
         <rect fill="#183059" width="70" height="48" rx="5"/><circle fill="#0595C3" cx="24" cy="24" r="15"/><circle fill="#D22538" cx="46" cy="24" r="15"/><path d="M27 28.5h10v3H27v-3zm1-6h10v3H28v-3zm-1-6h10v3H27v-3z" fill="#0595C3"/>
      </symbol>

      <symbol id="dinerslogo" width="22" viewBox="0 0 70 48">
         <rect fill="#DEE0E1" width="70" height="48" rx="5"/><path d="M39.7 43.5h-9.4C19.6 43.5 11 34.9 11 24.2v-.4c0-10.7 8.6-19.3 19.3-19.3h9.4C50.4 4.5 59 13.1 59 23.8v.4c0 10.7-8.6 19.3-19.3 19.3z" fill="#0A5495"/><path d="M31.6 8.2c-8.7 0-15.8 7.1-15.8 15.8s7.1 15.8 15.8 15.8 15.8-7 15.8-15.8c0-8.7-7.1-15.8-15.8-15.8zM20.3 24.1c0-5.1 3.2-9.4 8.2-10.6v21.3c-4.9-1.3-8.2-5.6-8.2-10.7zm13.3 10.6V13.4c5 1.2 8.2 5.5 8.2 10.6s-3.2 9.5-8.2 10.7z" fill="#FFF"/>
      </symbol>

      <symbol id="amexlogo" width="22" viewBox="0 0 70 48">
         <rect fill="#30ABE2" width="70" height="48" rx="5"/><path d="M29.8 26.2l-4-10.7h-5.1v15.4L15 15.5h-4.3L5 31.5h3.4l1.2-3.6h6.5l1.2 3.6h6.6V19.6l4.3 11.9h3l4.4-11.7v11.7h3.2v-16h-5.2c.1 0-3.8 10.7-3.8 10.7zm-16.9-1.8h-2l2-5.6v.2l2 5.4h-2zm46.4-1.2l2.4-3 3.4-4.7H61l-3.7 4.9-3.7-4.9H40.7v15.8h12.5l3.9-5.2 3.8 5.3H65l-3.4-4.9c.1.1-2.3-3.3-2.3-3.3zm-7.8 4.9h-7.4v-3.2h7.2v-3h-7.2V19h7.4l3.7 4.2-3.7 4.9z" fill="#FFF"/>
      </symbol>

      <symbol id="jcblogo" width="22" viewBox="0 0 70 48">
         <path d="M69 0v39c0 5-5 9-10.1 9H48V34h13s5 0 5-5-5-5-5-5 4 0 4-5-5-5-5-5H48V9c0-5 4-9 9-9h12zM52 31v-5h6s3 0 3 2.5-3 2.5-3 2.5h-6zm0-9v-5h5s3 0 3 2.5-3 2.5-3 2.5h-5z" fill="#2D9446"/><path d="M24 9c0-5 4-9 9-9h12v39c0 5-5 9-10 9H24V30s5 5 18 2v-4s-14 5-14-4c0-8 10.1-6.4 14-4v-4s-12-4-18 3V9z" fill="#BF2A3F"/><path d="M0 32s18 5 18-7V15h-6v10c0 7-12 2-12 2V9c0-5 4-9 9-9h12v39c0 5-5 9-10 9H0V32z" fill="#1B5899"/>
      </symbol>

      <symbol id="unionpaylogo" width="22" viewBox="0 0 70 48">
         <path d="M2.8 0C1.3 0 0 1.8 0 4v40c0 2.2 1.3 4 2.8 4H24V0H2.8z" fill="#E9272B" />
         <path d="M66.5 0H46v48h20.9c1.7 0 3.1-1.8 3.1-4V4c0-2.2-1.8-4-3.5-4z" fill="#0E8A8F" />
         <path fill="#00589F" d="M23.5 0h23v48h-23z" />
         <path d="M38.6 31.2H42l1-3.5h-3.4l-1 3.5zm2.7-9.6l-1.2 4.1 3.8-1.2.8-2.9h-3.4m1.7-5.9l-1.1 3.9 3.7-1.1.8-2.9H43m7.6.1l-4.4 15.4h1.2l-.9 3.2h-1.2l-.3 1h-4.2l.3-1h-8.5l.8-2.9h.9l5.3-18.8h4.3l-.4 1.6 2.2-1.2 7.3-.4-1 3.1h-1.4" fill="#FFF" />
         <path fill="#FFF" d="M52.4 12.6H57v1.8l.8.4h.9l-.8 3h-2.5l-2.9-1.9-.1-3.3M53 26.7h-4.3l.7-2.7h5l.7-2.4h-4.9l.8-3h13.7l-.9 3h-4.5l-.8 2.4h4.6l-.7 2.7h-5l-.9 1.1h2l.7 4 1.7.2-1 3.2h-2.6l-1.1-.5-.8-1.1-.5-3.3-2.3 3.2-3.3 1.9h-3.1l.8-2.9 2.1-.3 3.9-5.5M5.5 19.4H17l-.9 3h-4.6l-.7 2.4h4.7l-.8 3H10l-1.2 4.1 1.6.5 2.3-.4-.9 3.4-6.5-.2-.8-.7-.3-1.3 1.5-5.3H3.1l.8-3.1h2.7l.7-2.4H4.6l.9-3M13.2 14.2h4.7l-.8 3.1h-6.5l-1.5 1-4.1.6.8-2.9 1.7-.2 1.9-3.2H14l-.8 1.6"
         />
         <path d="M22.3 19.2l3.5-1.7 3.6-.1.5-1.7h-6.6l-1 3.5zm6.2 1.3h-6.6l-.4 1.4h6.6l.4-1.4M20 12.6h4l-.6 2.1 2.2-1.5 9.4-.7L31.6 23l-1.1 1.1-1.5.5-8.3.1-1.9 7.3.6.3 2.8-.3-.9 3.4-6.6-.4-.7-1 6-21.4" fill="#FFF" />
         <path fill="#FFF" d="M31.7 25.2l-1.1 3.3-2.2.8-2.2.1v2.1l.2.7.3.2 2.8-.2-.9 3.1-5.8-.4-.5-1.2.2-8.3h3.9v1.7L28 27l.6-1.8h3.1M66.6 12.7l-1.8 3.2-3.2 1.9-2.8-.1.8-2.8 1.2-.1 1.4-2.1h4.4" />
      </symbol>

      <symbol id="forbrugsforeningenlogo" width="22" viewBox="0 0 70 48">
         <rect fill="#70A0D1" width="70" height="48" rx="5"/><path d="M22 46v-9c10 0 9.84-3.17 10-10H18v-8h14c0-8 0-17 19-17v9c-7 0-9 1.487-9 8h9v8h-9c0 10 0 19-20 19z" fill="#FFF"/>
      </symbol>

      <symbol id="mobilepaylogo" width="22" viewBox="0 0 70 48">
         <rect fill="#D6E2E8" width="70" height="48" rx="5"/><path d="M37.6 17.7c.7-.1 1.4-.3 2.2-.4 1.1-.2 2.4-.3 3.8-.4v-.1c-.6-1.1-1.7-1.7-2.8-1.7-.5 0-1 .1-1.4.3-.1 0-.1.1-.2.1-.9.5-1.4 1.3-1.6 2.2z" fill="#003F62"/><path d="M57.3 19.4c0-.3-.3-.7-.6-.8h-11c-1.8.1-3.5.3-5 .5-3.7.5-6.2 1.3-6.2 1.3-.3.1-.6.5-.6.8l.6 11.7v.4h.6C.1 0 39 32 45.3 31.5l1.8 4.7-7 2.7-8.3 3.1-5.7-14.8-5.6-14.5 15.3-5.8 2.3 6c-.2.1-.4.2-.5.3-5.5 3.1-9.1 6.5-9.1 6.5-.2.2-.3.7-.1 1l4.5 7.8-.4-7.3c-.1-1 .6-1.9 1.5-2.2.1 0 1.1-.3 2.6-.7 0-.3.1-.7.2-1 .4-1.1 1.1-1.9 2.1-2.5h.1c.6-.3 1.3-.5 2-.5 1.7 0 3.1.9 3.9 2.4.1.2.2.3.2.5h.4c1.5-.1 2.9-.1 4.2-.1 1.7 0 3.1.1 4.2.1L49 8.9c-.2-.3-.6-.5-.9-.4 0 0-2.2.4-7.1 2.9l-3.3-8.5c-.6-1.5-2.4-2.3-3.9-1.7L18 6.5c-1.6.6-2.4 2.3-1.8 3.9l13.6 35.1c.6 1.5 2.4 2.3 3.9 1.7l15.5-5.8c1.6-.6 2.4-2.3 1.8-3.9l-2.6-6.7h5.9c.2 0 .4 0 .6.1h.3c.2 0 .3 0 .5.1.1 0 .3 0 .4.1h.2c.1 0 .2 0 .3.1.1 0 .3.1.4.1h.9v-.4l-.6-11.5zM44.2 40.8L38.3 43c-.3.1-.7 0-.8-.4-.1-.3 0-.7.3-.8l5.9-2.2c.3-.1.7 0 .8.4.1.4 0 .7-.3.8zm1.6-12c-.6 0-1.1-.1-1.6-.3-1.6-.6-2.7-2.2-2.7-4 0-.7.2-1.3.4-1.9.7-1.4 2.2-2.4 3.9-2.4 2.4 0 4.4 1.9 4.4 4.3-.1 2.4-2 4.3-4.4 4.3z" fill="#003F62"/><path d="M45.8 27.7c1.8 0 3.2-1.4 3.2-3.1 0-1.7-1.4-3.1-3.2-3.1-1.8 0-3.2 1.4-3.2 3.1 0 .8.3 1.5.8 2 .6.7 1.4 1.1 2.4 1.1z" fill="#003F62"/>
      </symbol>
   </svg>

   <script>/**
 *   First shalt thou take out the Holy Pin. Then...
 *   @author Ulrik Moe, Christian Blach, Joakim Sindholt
 *   @license GPLv3
 *
 *   Indentation: 3 spaces
 *   Conventions: https://github.com/airbnb/javascript
 **/

var currency_value = {
   'DKK': 1,
   'SEK': 0.800,
   'NOK': 0.810,
   'EUR': 7.461,
   'USD': 6.638
};

var currency_map = {
   'DKK': 'kr',
   'SEK': 'kr',
   'NOK': 'kr',
   'EUR': '€',
   'USD': '$'
};

var CARDs = {
   "dankort": {
      name: "Dankort",
      logo: '#dankortlogo'
   },
   "visa": {
      name: "Visa",
      logo: '#visalogo'
   },
   "mastercard": {
      name: "MasterCard",
      logo: '#mastercardlogo'
   },
   "maestro": {
      name: "Maestro",
      logo: '#maestrologo'
   },
   "diners": {
      name: "Diners",
      logo: '#dinerslogo'
   },
   "amex": {
      name: "American Express",
      logo: '#amexlogo'
   },
   "jcb": {
      name: "JCB",
      logo: '#jcblogo'
   },
   "unionpay": {
      name: "UnionPay",
      logo: '#unionpaylogo'
   },
   "forbrugsforeningen": {
      name: "Forbrugsforeningen",
      logo: '#forbrugsforeningenlogo',
      costfn: function(o) {
         // We will calc the actual costs when we get some usage stats (ETA Q4 2015)
         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(0, 'DKK'),
            trans: new Currency(0, 'DKK')
         };
      },
   },
   "mobilepay": {
      name: "MobilePay",
      logo: "#mobilepaylogo",
      costfn: function(o) {
         // We will calc the actual costs when we get some usage stats (ETA Q4 2015)
         return {
            setup: new Currency(49, 'DKK'),
            monthly: new Currency(49, 'DKK'),
            trans: new Currency(1, 'DKK')
         };
      }
   }
};


var ACQs = {
   "teller": {
      name: "Teller",
      logo: "teller.svg",
      link: "http://www.teller.com",
      cards: objectize(["visa", "mastercard", "maestro", "amex", "jcb", "unionpay", "diners", "mobilepay"]),
      fee_setup: new Currency(1000, 'DKK'),
      fee_monthly: new Currency(149, 'DKK'),
      fee_fixed: new Currency(0, 'DKK'),
      fee_variable: 1.5,
      costfn: function(o) {
         var gebyr = this.fee_fixed.add(o.avgvalue.scale(this.fee_variable / 100));
         if (gebyr.dkk() < 0.7) {
            gebyr = new Currency(0.7, 'DKK');
         }
         gebyr = gebyr.scale(o.transactions);
         return {
            trans: gebyr,
            total: gebyr.add(this.fee_monthly)
         };
      }
   },
   "handelsbanken": {
      name: "Handelsbanken",
      logo: "handelsbanken.svg",
      link: "http://www.handelsbanken.dk",
      cards: objectize(["visa", "mastercard", "maestro"]),
      fee_setup: new Currency(0, 'DKK'),
      fee_monthly: new Currency(0, 'DKK'),
      fee_fixed: new Currency(0, 'DKK'),
      fee_variable: 1.5,
      costfn: acq_cost_default
   },
   "nets": {
      name: "Nets",
      logo: "nets.svg",
      link: "http://www.nets.eu",
      cards: objectize(["dankort", "forbrugsforeningen", "mobilepay"]),
      fee_setup: new Currency(250, 'DKK'),
      fee_monthly: new Currency(1000 / 12, 'DKK'),
      costfn: function(o) {
         var gebyr = 1.39;
         var gnspris = o.avgvalue.dkk();
         if (gnspris <= 100) {
            gebyr = 1.1;
         }
         if (gnspris <= 50) {
            gebyr = 0.7;
         }
         gebyr = (new Currency(gebyr, 'DKK')).scale(o.transactions);
         return {
            trans: gebyr,
            total: gebyr.add(this.fee_monthly)
         };
      }
   },
   "swedbank": {
      name: "Swedbank",
      logo: "swedbank.png",
      link: "http://www.swedbank.dk",
      cards: objectize(["visa", "mastercard", "maestro"]),
      fee_setup: new Currency(1900, 'DKK'),
      fee_monthly: new Currency(100, 'DKK'),
      fee_fixed: new Currency(0, 'DKK'),
      fee_variable: 1.6,
      costfn: acq_cost_default
   },
   "valitor": {
      name: "Valitor",
      logo: "valitor.png",
      link: "http://www.valitor.com",
      cards: objectize(["visa", "mastercard", "maestro"]),
      fee_setup: new Currency(0, 'DKK'),
      fee_monthly: new Currency(0, 'DKK'),
      fee_fixed: new Currency(0, 'DKK'),
      fee_variable: 1.5,
      costfn: acq_cost_default
   },
   "elavon": {
      name: "Elavon",
      logo: "elavon.svg",
      link: "http://www.elavon.com",
      cards: objectize(["visa", "mastercard", "maestro"]),
      fee_setup: new Currency(0, 'DKK'),
      fee_monthly: new Currency(0, 'DKK'),
      fee_fixed: new Currency(0, 'DKK'),
      fee_variable: 1.6,
      costfn: acq_cost_default
   },
   "clearhaus": {
      name: "Clearhaus",
      logo: "clearhaus.svg",
      link: "https://www.clearhaus.com",
      cards: objectize(["visa", "mastercard", "maestro", "mobilepay"]),
      fee_setup: new Currency(0, 'DKK'),
      fee_monthly: new Currency(0, 'DKK'),
      fee_fixed: new Currency(0, 'DKK'),
      fee_variable: 1.45,
      costfn: acq_cost_default
   }
};



var PSPs = [{
      name: "Braintree",
      logo: "braintree.svg",
      link: "https://www.braintreepayments.com",
      features: objectize(["antifraud", "recurring"]),
      cards: objectize(["visa", "mastercard", "maestro"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(0, 'DKK'),
            trans: o.avgvalue.scale(2.9 / 100).add(new Currency(2.25, 'DKK')).scale(o.transactions)
         };
      }
   }, {
      name: "Certitrade",
      logo: "certitrade.svg",
      link: "http://www.certitrade.net/kortbetalning.php",
      features: objectize(["antifraud"]),
      acquirers: objectize(["handelsbanken", "nordea", "swedbank", "clearhaus"]),
      cards: objectize(["visa", "mastercard", "maestro", "diners", "amex"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'SEK'),
            monthly: new Currency(192, 'SEK'),
            trans: o.avgvalue.scale(0.9 / 100).add(new Currency(1.5, 'SEK')).scale(o.transactions)
         };
      }
   }, {
      name: "Checkout.com",
      logo: "checkout.svg",
      link: "https://www.checkout.com",
      features: objectize(["antifraud", "recurring"]),
      cards: objectize(["visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(0, 'DKK'),
            trans: o.avgvalue.scale(1.5 / 100).add(new Currency(0.15, 'EUR')).scale(o.transactions)
         };
      }
   }, {
      name: "DanDomain",
      logo: "dandomain.svg",
      link: "https://www.dandomain.dk/e-handel/betalingssystem",
      features: objectize(["recurring"]),
      acquirers: objectize(["nets", "teller"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "forbrugsforeningen", "diners", "jcb", "amex", "unionpay"]),
      costfn: function(o) {

         var recurring = {};
         recurring.setup = 0;
         recurring.monthly = 0;

         if (o.features.recurring) {
            recurring.setup = new Currency(299, 'DKK');

            if (o.transactions < 100) {
               recurring.monthly = 99;
            } else if (o.transactions < 1000) {
               recurring.monthly = 149;
            } else {
               recurring.monthly = 399;
            }

            recurring.monthly = new Currency(recurring.monthly, 'DKK');
         }
         return {
            setup: new Currency(298, 'DKK').add(recurring.setup), // 199 + 99 (3D)
            monthly: new Currency(198, 'DKK').add(recurring.monthly), // 149 + 49 (3D)
            trans: new Currency(0, 'DKK')
         };
      }
   }, {
      name: "DIBS Start",
      logo: "dibs.svg",
      link: "http://dibs.dk",
      features: {},
      acquirers: objectize(["nets"]),
      cards: objectize(["dankort", "mobilepay"]),
      costfn: function(o) {
         return {
            setup: new Currency(1495, 'DKK'),
            monthly: new Currency(149, 'DKK'),
            trans: new Currency(0.6, 'DKK').scale(o.transactions)
         };
      }
   }, {
      name: "DIBS Medium",
      logo: "dibs.svg",
      link: "http://dibs.dk",
      features: objectize(["antifraud"]),
      acquirers: objectize(["nets", "teller", "swedbank", "valitor", "handelsbanken", "elavon"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay", "diners", "mobilepay"]),
      costfn: function(o) {

         var antifraud = {};
         antifraud.setup = 0;
         antifraud.monthly = 0;
         if (o.features.antifraud) {
            antifraud.setup = new Currency(495, 'DKK');
            antifraud.monthly = new Currency(49, 'DKK');
         }

         return {
            setup: new Currency(4995, 'DKK').add(antifraud.setup),
            monthly: new Currency(499, 'DKK').add(antifraud.monthly),
            trans: new Currency(0.55, 'DKK').scale(o.transactions)
         };
      }
   }, {
      name: "DIBS Premium",
      logo: "dibs.svg",
      link: "http://dibs.dk",
      features: objectize(["antifraud", "recurring", "multiacquirer"]),
      acquirers: objectize(["nets", "teller", "swedbank", "valitor", "handelsbanken", "elavon"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay", "forbrugsforeningen", "diners", "mobilepay"]),
      costfn: function(o) {

         var antifraud = {};
         antifraud.setup = 0;
         antifraud.monthly = 0;
         if (o.features.antifraud) {
            antifraud.setup = new Currency(495, 'DKK');
            antifraud.monthly = new Currency(49, 'DKK');
         }

         return {
            setup: new Currency(10995, 'DKK').add(antifraud.setup),
            monthly: new Currency(899, 'DKK').add(antifraud.monthly),
            trans: new Currency(0.5, 'DKK').scale(o.transactions)
         };
      }
   }, {
      name: "ePay Light",
      logo: "epay.svg",
      link: "http://epay.dk",
      features: objectize(["antifraud"]),
      acquirers: objectize(["nets"]),
      cards: objectize(["dankort", "forbrugsforeningen", "mobilepay"]),
      costfn: function(o) {
         var fee = 0.25;
         var antifraud = 0;
         if (o.features.antifraud) {
            antifraud = (new Currency(0.3, 'DKK')).scale(o.transactions);
         }
         return {
            setup: new Currency(399, 'DKK'),
            monthly: new Currency(99, 'DKK'),
            trans: new Currency(fee, 'DKK').scale(Math.max(o.transactions - 250, 0)).add(antifraud)
         };
      }
   }, {
      name: "ePay Pro",
      logo: "epay.svg",
      link: "http://epay.dk",
      features: objectize(["antifraud"]),
      acquirers: objectize(["nets", "teller"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay", "forbrugsforeningen", "mobilepay"]),
      costfn: function(o) {
         var fee = 0.25;
         var antifraud = 0;

         if (o.features.antifraud) {
            antifraud = (new Currency(0.3, 'DKK')).scale(o.transactions);
         }
         return {
            setup: new Currency(599, 'DKK'),
            monthly: new Currency(199, 'DKK'),
            trans: new Currency(fee, 'DKK').scale(Math.max(o.transactions - 250, 0)).add(antifraud)
         };
      }
   }, {
      name: "ePay Business",
      logo: "epay.svg",
      link: "http://epay.dk",
      features: objectize(["antifraud", "recurring", "multiacquirer"]),
      acquirers: objectize(["nets", "teller", "swedbank", "handelsbanken", "valitor", "elavon", "clearhaus"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay", "forbrugsforeningen", "mobilepay"]),
      costfn: function(o) {
         var fee = 0.25,
            antifraud = 0,
            recurring = 0;

         if (o.features.antifraud) {
            antifraud = (new Currency(0.3, 'DKK')).scale(o.transactions);
         }
         if (o.features.recurring) {
            recurring = (new Currency(1 / 12, 'DKK')).scale(o.transactions);
         }

         return {
            setup: new Currency(999, 'DKK').add(recurring),
            monthly: new Currency(299, 'DKK'),
            trans: new Currency(fee, 'DKK').scale(Math.max(o.transactions - 500, 0)).add(antifraud).add(recurring)
         };
      }
   }, {
      name: "Netaxept Start",
      logo: "netaxept.svg",
      link: "https://www.terminalshop.dk/Netaxept/",
      features: objectize(["antifraud"]),
      acquirers: objectize(["nets", "teller"]),
      cards: objectize(["dankort", "visa", "mastercard"]),
      costfn: function(o) {
         return {
            setup: new Currency(1005, 'DKK'),
            monthly: new Currency(180, 'DKK'),
            trans: new Currency(1.5, 'DKK').scale(o.transactions)
         };
      }
   }, {
      name: "Netaxept Plus",
      logo: "netaxept.svg",
      link: "https://www.terminalshop.dk/Netaxept/",
      features: objectize(["antifraud"]),
      acquirers: objectize(["nets", "teller", "elavon", "swedbank", "nordea"]),
      cards: objectize(["dankort", "visa", "mastercard", "diners", "jcb", "amex", "unionpay"]),
      costfn: function(o) {
         return {
            setup: new Currency(3016, 'DKK'),
            monthly: new Currency(502, 'DKK'),
            trans: new Currency(1, 'DKK').scale(o.transactions)
         };
      }
   }, {
      name: "Netaxept Advanced",
      logo: "netaxept.svg",
      link: "https://www.terminalshop.dk/Netaxept/",
      features: objectize(["antifraud", "recurring"]),
      acquirers: objectize(["nets", "teller", "elavon", "swedbank", "nordea"]),
      cards: objectize(["dankort", "visa", "mastercard", "diners", "jcb", "amex", "unionpay"]),
      costfn: function(o) {
         var recurring = 0;
         if (o.features.recurring) {
            recurring = new Currency(250, 'DKK');
         }
         return {
            setup: new Currency(7540, 'DKK'),
            monthly: new Currency(703, 'DKK').add(recurring),
            trans: new Currency(0.7, 'DKK').scale(o.transactions)
         };
      }
   }, {
      name: "Payer",
      logo: "payer.svg",
      link: "http://payer.se/betallosning/",
      features: {},
      acquirers: objectize(["handelsbanken", "swedbank", "nordea"]),
      cards: objectize(["visa", "mastercard", "maestro", "diners", "amex"]),
      costfn: function(o) {
         return {
            setup: new Currency(1400, 'SEK'),
            monthly: new Currency(400, 'SEK'),
            trans: new Currency(2, 'SEK').scale(o.transactions)
         };
      }
   }, {
      name: "Paymill",
      logo: "paymill.svg",
      link: "https://paymill.com",
      features: objectize(["antifraud", "recurring"]),
      cards: objectize(["visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'EUR'),
            monthly: new Currency(0, 'EUR'),
            trans: o.avgvalue.scale(2.95 / 100).add(new Currency(0.28, 'EUR')).scale(o.transactions)
         };
      }
   }, {
      name: "PayPal",
      logo: "paypal.svg",
      link: "https://paypal.com",
      features: objectize(["antifraud", "recurring"]),
      cards: objectize(["visa", "mastercard", "maestro", "diners", "jcb", "amex"]),
      costfn: function(o) {
         var oms = o.transactions * o.avgvalue.dkk();
         var fee = 1.9;
         if (oms <= 800000) {
            fee = 2.4;
         }
         if (oms <= 400000) {
            fee = 2.7;
         }
         if (oms <= 80000) {
            fee = 2.9;
         }
         if (oms <= 20000) {
            fee = 3.4;
         }

         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(0, 'DKK'),
            trans: o.avgvalue.scale(fee / 100).add(new Currency(2.6, 'DKK')).scale(o.transactions)
         };
      }
   }, {
      name: "Payson",
      logo: "payson.png",
      link: "https://www.payson.se",
      features: objectize(["antifraud"]),
      cards: objectize(["visa", "mastercard", "maestro"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'SEK'),
            monthly: new Currency(0, 'SEK'),
            trans: o.avgvalue.scale(3 / 100).add(new Currency(3, 'SEK')).scale(o.transactions)
         };
      }
   }, {
      name: "Payza",
      logo: "payza.svg",
      link: "https://payza.com",
      features: objectize(["antifraud"]),
      cards: objectize(["visa", "mastercard", "maestro"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'EUR'),
            monthly: new Currency(20, 'EUR'),
            trans: o.avgvalue.scale(2.5 / 100).add(new Currency(0.25, 'EUR')).scale(o.transactions)
         };
      }
   }, {
      name: "Verifone Bas",
      logo: "verifone.svg",
      link: "http://www.verifone.se/sv/Sweden/Start/E-handel/",
      features: {},
      acquirers: objectize(["handelsbanken", "nordea", "swedbank"]),
      cards: objectize(["visa", "mastercard", "diners", "jcb", "amex"]),
      costfn: function(o) {
         return {
            setup: new Currency(999, 'SEK'),
            monthly: new Currency(199, 'SEK'),
            trans: new Currency(4, 'SEK').scale(Math.max(o.transactions - 100, 0))
         };
      }
   }, {
      name: "Verifone Premium",
      logo: "verifone.svg",
      link: "http://www.verifone.se/sv/Sweden/Start/E-handel/",
      features: {},
      acquirers: objectize(["handelsbanken", "nordea", "swedbank"]),
      cards: objectize(["visa", "mastercard", "diners", "jcb", "amex"]),
      costfn: function(o) {
         return {
            setup: new Currency(2499, 'SEK'),
            monthly: new Currency(499, 'SEK'),
            trans: new Currency(2.5, 'SEK').scale(Math.max(o.transactions - 400, 0))
         };
      }
   }, {
      name: "Verifone PremiumPlus",
      logo: "verifone.svg",
      link: "http://www.verifone.se/sv/Sweden/Start/E-handel/",
      features: {},
      acquirers: objectize(["nets", "handelsbanken", "nordea", "swedbank"]),
      cards: objectize(["dankort", "visa", "mastercard", "diners", "amex", "jcb"]),
      costfn: function(o) {
         return {
            setup: new Currency(4999, 'SEK'),
            monthly: new Currency(1999, 'SEK'),
            trans: new Currency(0.75, 'SEK').scale(Math.max(o.transactions - 4000, 0))
         };
      }
   }, {
      name: "Stripe",
      logo: "stripe.svg",
      link: "https://stripe.com",
      features: objectize(["antifraud", "recurring"]),
      cards: objectize(["visa", "mastercard", "maestro", "amex"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'USD'),
            monthly: new Currency(0, 'USD'),
            trans: o.avgvalue.scale(1.7 / 100).add(new Currency(1.8, 'DKK')).scale(o.transactions)
         };
      }
   }, {
      name: "QuickPay Standard",
      logo: "quickpay.svg",
      link: "https://quickpay.net",
      features: objectize(["antifraud", "recurring", "multiacquirer"]),
      acquirers: objectize(["nets", "teller", "clearhaus"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay", "forbrugsforeningen", "mobilepay"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(49, 'DKK'),
            trans: new Currency(1, 'DKK').scale(o.transactions)
         };
      }
   }, {
      name: "QuickPay Professional",
      logo: "quickpay.svg",
      link: "https://quickpay.net",
      features: objectize(["antifraud", "recurring", "multiacquirer"]),
      acquirers: objectize(["nets", "teller", "clearhaus"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay", "forbrugsforeningen", "mobilepay"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(149, 'DKK'),
            trans: new Currency(0.25, 'DKK').scale(Math.max(o.transactions - 250, 0))
         };
      }
   }, {
      name: "Scannet",
      logo: "scannet.png",
      link: "http://www.scannet.dk/hosting/betalingsloesning/",
      features: {},
      acquirers: objectize(["nets", "teller"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay"]),
      costfn: function(o) {
         return {
            setup: new Currency(950, 'DKK'),
            monthly: new Currency(399, 'DKK'),
            trans: new Currency(0, 'DKK')
         };
      }
   }, {
      name: "Skrill",
      logo: "skrill.svg",
      link: "https://skrill.com",
      features: objectize(["antifraud", "recurring"]),
      cards: objectize(["visa", "mastercard", "maestro", "diners", "jcb", "amex"]),
      costfn: function(o) {
         var oms = o.transactions * o.avgvalue.dkk();
         var fee = 2.9;

         return {
            setup: new Currency(0, 'EUR'),
            monthly: new Currency(21.75, 'EUR'),
            trans: o.avgvalue.scale(fee / 100).add(new Currency(0.25, 'EUR')).scale(o.transactions)
         };
      }
   }, {
      name: "Wannafind",
      logo: "wannafind.svg",
      link: "https://www.wannafind.dk/betalingsgateway/",
      features: objectize(["recurring", "antifraud"]),
      acquirers: objectize(["nets", "teller"]),
      cards: objectize(["dankort", "visa", "mastercard", "maestro", "diners", "jcb", "amex", "unionpay"]),
      costfn: function(o) {

         var recurring = 0;
         if (o.features.recurring) {
            recurring = (new Currency(99, 'DKK'));
         }
         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(198, 'DKK').add(recurring), // 149 + 49 (3D secure)
            trans: new Currency(0, 'DKK')
         };
      }
   }, {
      name: "YourPay",
      logo: "yourpay.png",
      link: "http://yourpay.dk",
      features: {},
      cards: objectize(["visa", "mastercard", "maestro"]),
      costfn: function(o) {

         var fee = 2.25;

         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(0, 'DKK'),
            trans: o.avgvalue.scale(fee / 100).scale(Math.max(o.transactions, 0))
         };
      }
   }, {
      name: "Klarna",
      logo: "klarna.svg",
      link: "https://klarna.se",
      product: "checkout",
      features: {},
      cards: objectize(["visa", "mastercard", "maestro"]),
      costfn: function(o) {

         var fee = 2.95;

         return {
            setup: new Currency(3995, 'SEK'),
            monthly: new Currency(599, 'SEK'),
            trans: o.avgvalue.scale(fee / 100).scale(o.transactions)
         };
      }
   }, {
      name: "2checkout",
      logo: "2checkout.svg",
      link: "https://www.2checkout.com",
      features: objectize(["antifraud", "recurring"]),
      cards: objectize(["visa", "mastercard", "maestro", "amex", "jcb", "diners"]),
      costfn: function(o) {
         var fee = 2.4;
         return {
            setup: new Currency(0, 'USD'),
            monthly: new Currency(0, 'USD'),
            trans: o.avgvalue.scale(fee / 100).add(new Currency(0.30, 'USD')).scale(o.transactions)
         };
      }
   }, {
      name: "Paylike",
      logo: "paylike.svg",
      link: "https://paylike.io",
      features: objectize(["antifraud"]),
      cards: objectize(["visa", "mastercard", "maestro"]),
      costfn: function(o) {
         return {
            setup: new Currency(0, 'DKK'),
            monthly: new Currency(0, 'DKK'),
            trans: o.avgvalue.scale(2.5 / 100).add(new Currency(0.25, 'EUR')).scale(o.transactions)
         };
      },
   }
];

/**
*  First shalt thou take out the Holy Pin. Then...
*  @author Ulrik Moe, Christian Blach, Joakim Sindholt
*  @license GPLv3
*
*  Indentation: 3 spaces
*  Conventions: https://github.com/airbnb/javascript
*
*  Ugly fixes:
*  1) Nets needs to be the first acquirer in acquirersort. The problem is that
*     we don't iterate through acquirers properly when we try to find the
*     cheapest combination of acquirers.
*
*  To do:
*  1) loadurl: add backward compatibility.
*
*
 **/

// Constants
var table = $('table');

// Global variables
var i, k, l, sort;
var stopwatch;
var gccode = 'DKK';

// Functions
function $(s) { return document.getElementById(s); }
function C(s) { return document.getElementsByClassName(s); }

function set_ccode(c) {
   if (currency_map.hasOwnProperty(c)) {
      gccode = c;
   }
}

function Currency(amt, code) {
   this.amounts = {};
   this.amounts[code] = amt;
}

Currency.prototype.type = "currency";

Currency.prototype.print = function() {
   var number = Math.round((this.dkk() * 100) / currency_value[gccode]) / 100;
   var parts = number.toString().split(".");
   parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
   if (parts.length == 2 && parts[1].length == 1) {
      parts[1] += "0";
   }
   return parts.join(",") + " " + currency_map[gccode];
};

Currency.prototype.represent = function() {
   if (this.length() === 1) {
      for (var code in this.amounts) {
         //if (currency_map.hasOwnProperty(code)) {
         //    return this.amounts[code] + ' ' + currency_map[code];
         //}
         return this.amounts[code] + ' ' + code;
      }
   }
   return this.dkk() / currency_value[gccode] + ' ' + gccode; //currency_map[gccode];
};

Currency.prototype.string = function() {
   if (this.length() === 1) {
      for (var code in this.amounts) {
         return this.amounts[code] + code;
      }
   }
   return this.dkk() / currency_value[gccode] + gccode; //currency_map[gccode];
};

Currency.prototype.length = function() {
   var k, n = 0;
   for (k in this.amounts) {
      if (this.amounts.hasOwnProperty(k)) {
         n++;
      }
   }
   return n;
};

Currency.prototype.dkk = function() {
   var sum = 0;
   for (var code in this.amounts) {
      if (this.amounts.hasOwnProperty(code) &&
         currency_value.hasOwnProperty(code)) {
         sum += currency_value[code] * this.amounts[code];
      }
   }
   return sum;
};

Currency.prototype.add = function(rhs) {
   var n = new Currency(0, 'DKK');
   var code;

   for (code in this.amounts) {
      if (this.amounts.hasOwnProperty(code)) {
         n.amounts[code] = this.amounts[code];
      }
   }

   for (code in rhs.amounts) {
      if (rhs.amounts.hasOwnProperty(code)) {
         if (!n.amounts.hasOwnProperty(code)) {
            n.amounts[code] = 0;
         }
         n.amounts[code] += rhs.amounts[code];
      }
   }
   return n;
};


Currency.prototype.is_equal_to = function(other_currency_object) {
   for (var code in this.amounts) {
      if (this.amounts.hasOwnProperty(code)) {
         if (this.amounts[code] !== other_currency_object.amounts[code]) {
            return false;
         }
      }
   }
   return true;
};

Currency.prototype.scale = function(rhs) {
   var n = new Currency(0, 'DKK');

   for (var code in this.amounts) {
      if (this.amounts.hasOwnProperty(code)) {
         n.amounts[code] = this.amounts[code] * rhs;
      }
   }
   return n;
};

function cardsCovered(acqs, s) {
   // Check if all cards in settings.cards are covered
   // with the selected acquirers (acqs).

   for (var _card in s.cards) {

      var cardfound = false;
      for (var _acq in acqs) {

         if( ACQs[_acq].cards[_card] ){
            cardfound = true;
            break;
         }
      }
      if (!cardfound) { return false; }
   }
   return true;
}

function clone(obj) {
    var copy = obj.constructor();
    for (var attr in obj) {
        if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
    }
    return copy;
}

function acq_cost_default(o) {
   var _t = o.avgvalue.scale(this.fee_variable / 100).add(this.fee_fixed).scale(o.transactions);
   return {
      trans: _t,
      total: _t.add(this.fee_monthly)
   };
}

function getInt(elem, action) {

   if (action === 'init') { elem.addEventListener("input", build, false); }

   var str = elem.value.trim();
   if (!isNaN(parseFloat(str)) && isFinite(str) &&
      parseFloat(str) == parseInt(str, 10)) {
      elem.classList.remove('error');
      return parseInt(str, 10);
   }
   $(k).classList.add('error');
   return null;
}

function setInt(k, v) {
   $(k).value = parseInt(v, 10);
   $(k).classList.remove('error');
}

function mkcurregex() {
   var k, a = [];
   for (k in currency_map) {
      a.push(currency_map[k]);
   }
   for (k in currency_value) {
      a.push(k);
   }
   return RegExp("^ *([0-9][0-9., ]*)(" + a.join("|") + ")? *$", "i");
}
var curregex = mkcurregex();

function _getCurrency(currency) {
   var a = currency.match(curregex);
   if (a === null) {
      return null;
   }
   var c = a[2] ? a[2] : currency_map[gccode];
   if (c.toLowerCase() === currency_map[gccode].toLowerCase()) {
      /* there are a lot of currencies named kr and we should prefer the kr
       * that has been selected */
      c = gccode;
   } else {
      /* if that's not what's selected, find the currency */
      for (var k in currency_map) {
         if (currency_map[k].toLowerCase() === c.toLowerCase() ||
            k.toLowerCase() === c.toLowerCase()) {
            c = k;
            break;
         }
      }
   }
   return new Currency(parseFloat(a[1].replace('.', '').replace(',', '.')), c);
}

function getCurrency(currency, action) {

   if (action === 'init') { $(currency).addEventListener("input", build, false); }

   var a = _getCurrency($(currency).value);
   if (a === null) {
      $(currency).classList.add('error');
      return null;
   }
   $(currency).classList.remove('error');
   return a;
}

function changeCurrency(option) {
   $('currency_code').innerHTML = option.value;
   set_ccode(option.value);
   build();
   //save_url();
}

function setCurrency(k, v) {
   $(k).value = v.represent();
   $(k).classList.remove('error');
}

function getPercent(k) {
   var elem = $(k);
   var str = elem.value.replace('%', '').replace(',', '.').trim();
   if (!isNaN(parseFloat(str)) && isFinite(str)) {
      $(k).classList.remove('error');
      return parseFloat(str);
   }
   $(k).classList.add('error');
   return null;
}

function setPercent(k, v) {
   $(k).value = (parseFloat(v) + "%").replace('.', ',');
   $(k).classList.remove('error');
}

function tooltip() {

   console.log("hover");

}


var opts = {
   'cards': {
      type: "bits",
      bits: function() {
          return C("ocards").length;
      },
      get: function(action) {
         // Get all selected payment methods from .ocards
         var object = {};
         var ocards = C("ocards");
         var bitval = 0;
         for(i = 0; i < ocards.length; i++) {
            var checkbox = ocards[i];
            if (action === 'init') { checkbox.addEventListener("click", build, false); }

            if (checkbox.checked) {
               object[checkbox.id] = CARDs[checkbox.id];
               if (checkbox.id == "visa") { object.mastercard = CARDs.mastercard; }
               bitval += 1 << i;
            }
         }
         if (action === "url") { return bitval; }
         return object;
      },
      set: function(bitval) {
         var ocards = C("ocards");
         for(i = 0; i < ocards.length; i++) {
            var checkbox = ocards[i];
            checkbox.checked = (bitval & (1 << i)) !== 0;
         }
      }
   },
   'features': {
      type: "bits",
      bits: function() {
          return C("ofeatures").length;
      },
      get: function(action) {
         // Get all selected features
         var object = {};
         var ofeatures = C("ofeatures");
         var bitval = 0;
         for(i = 0; i < ofeatures.length; i++) {
            var checkbox = ofeatures[i];
            if (action === 'init') { checkbox.addEventListener("click", build, false); }
            if ( checkbox.checked ) {
                object[checkbox.id] = 1;
                bitval += 1 << i;
            }
            //if (action === "url") console.log(ofeatures[i].id + ": " + checkbox.checked);
         }
         if (action === "url") {return bitval;}
         return object;
      },
      set: function(bitval) {
         var ofeatures = C("ofeatures");
         for(i = 0; i < ofeatures.length; i++) {
             var checkbox = ofeatures[i];
             checkbox.checked = (bitval & (1 << i)) !== 0;
         }
      }
   },
   // Misc
   'acquirers': {
      type: "bits",
      bits: function() {
          var len = $("acquirer").length;
          var nbits = 0;
          while (len > 0) {
              len = len >>> 1;
              nbits++;
          }
          return nbits;
      },
      get: function(action) {
         if (action === 'init') { $('acquirer').addEventListener("change", build, false); }

         // Return the selected acquirers
         var name = $("acquirer").value;
         if (action === "url" ){
             return $("acquirer").selectedIndex;
         }
         if ($("acquirer").value == 'auto') {
            return ACQs;
         }
         else {
            var objekt = {};
            objekt[name] = ACQs[name];
            return objekt;
         }
      },
      set: function(bitval) {
         if (bitval < $("acquirer").length) { $("acquirer").selectedIndex = bitval; }
      },
   },
   'transactions': {
      type: "string",
      dirty_bits: 1,
      get_dirty_bits: function() { return +(this.get() !== parseInt($('transactions').defaultValue)); },
      get: function(action) { return getInt($('transactions'), action); },
      set: function(v) { setInt('transactions', v); }
   },
   'avgvalue': {
      type: "currency",
      dirty_bits: 1,
      get_dirty_bits: function() { console.log("?????");console.log(this.get());console.log(_getCurrency($('avgvalue').defaultValue));
          return +(!this.get().is_equal_to(_getCurrency($('avgvalue').defaultValue))); },
      get: function(action) { return getCurrency('avgvalue', action); },
      set: function(v) { setCurrency('avgvalue', _getCurrency(v)); }
   },
   'currency': {
      type: "string",
      dirty_bits: 1,
       get_dirty_bits: function() { return +(this.get() !== $('currency_code_select').options[0].value); },
      get: function() { return gccode; },
      set: function(v) {
         var select = $("currency_code_select");
         for (var i = 0; i < select.length; i++) {
            if (select.options[i].value === v) {
               select.selectedIndex = i;
               $('currency_code').innerHTML = v;
               break;
            }
         }
         set_ccode(v);
      }
   },
   // Dirty bits: bit0 = er der ændret i antal/gns, bit 1..N_acquirers+1 er der ændret i acquirer costs?  --- Objekter der bruger dirty-bits skal være EFTER
   /*'dirty_bits': {
      type: "bits",
      bits: 0, //sættes on the fly
      get: function() {
         var sum = 0;
         for (var k in opts) {
            if (opts.hasOwnProperty(k) && opts[k].dirty_bits) {
               sum = (sum << opts[k].dirty_bits) + opts[k].get_dirty_bits();
            }
         }
         return sum; //17;// detect de acquirers der er ændret i og konverter til binary
         // 17 => nummber 1 og nummer 5
      },
      set: function(i) {}
   }*/
};

function objectize(arr) {
   // Array to object
   var objekt = {};
   for (i = 0; i < arr.length; i++)
   {
      objekt[arr[i]] = 1;
   }
   return objekt;
}

function build(action) {
   stopwatch = performance.now();
   console.log( (performance.now()-stopwatch).toFixed(4) +"ms ::: build() start");

   if (action == 'init') {
      //init_dirty_bits(); // 0.3 ms
      loadurl(); // 0.4 ms
   }

   // Get settings
   var settings = {};
   for (var key in opts) { if (key !== "dirty_bits") { settings[key] = opts[key].get(action); }}
   var acquirers = clone(settings.acquirers);

   settings.acquirersort = [];

   if ( !settings.cards.dankort ) {

      delete acquirers.nets;
      settings.dankort_scale = 0;

      if ( !settings.cards.visa ) {
         $('tbody').innerHTML = "";
         alert("Venligst vælg enten Dankort, Visa eller MasterCard.");
         return;
      }
      if ( settings.cards.forbrugsforeningen ) {
         $('tbody').innerHTML = "";
         alert("Forbrugsforeningens kontokort kræver en Dankort aftale.");
         return;
      }
   }
   else {
      acquirers.nets = ACQs.nets;
      settings.dankort_scale = (!settings.cards.visa) ? 1 : 0.77;
   }

   var costs = {};
   var data = [];
   var tbody = document.createElement("tbody");
   tbody.id = "tbody";

   for (i in acquirers) {

      // Calculate individual acquirer costs
      acquirers[i].fee = acquirers[i].costfn(settings);

      if (i == "nets") { continue; } // uglyfix[1]

      for (sort = 0; sort < settings.acquirersort.length; sort++){
         if ( acquirers[i].fee.total.dkk() < acquirers[settings.acquirersort[sort]].fee.total.dkk() ) {
            break;
         }
      }

      settings.acquirersort.splice(sort, 0, i);
   }
   if (acquirers.nets) { settings.acquirersort.splice(0, 0, "nets"); } // uglyfix[1]

   for (i in settings.cards) {
      // Some payment methods have extra costs. Lets calculate them.
      if (settings.cards[i].costfn){
         settings.cards[i].fee = settings.cards[i].costfn(settings);
      }
   }

   console.log( (performance.now()-stopwatch).toFixed(3) +"ms ::: time to build PSPs.");

   var klik = function(psp, acquirers, acqlabels, settings) {
      return function() {
         buildInfoModal(psp, acquirers, acqlabels, settings);
      };
   };

   psploop:
   for (k in PSPs) {

      var psp = PSPs[k];
      var acq = clone(psp.acquirers || {});
      var setup = new Currency(0, 'DKK'), recurring = new Currency(0, 'DKK'), total = new Currency(0, 'DKK');
      var cardobj = {};

      // Check if psp support all cards
      for (i in settings.cards) {
         if( !psp.cards[i] ){ continue psploop; }
      }
      // Check if psp support all features
      for (i in settings.features) {
         if( !psp.features[i] ){ continue psploop; }
      }

      // If a specific acquirer has been chosen (select dropdown)
      if ( Object.keys(settings.acquirers).length === 1 ){

         // Skip psp if it does not support selected acquirer
         if( !acq[Object.keys(settings.acquirers)[0]] ){
            continue psploop;
         }
      }

      if( Object.getOwnPropertyNames(acq).length === 0) {
         // All-in-one solutions, e.g. Stripe.
         cardobj = psp.cards;
      }
      else {
         // Payment Gateways, e.g. DIBS.
         var newacq = {};

         // Find cheapest acquirer that support all cards
         for (i = 0; i < settings.acquirersort.length; i++) {

            var _acq = settings.acquirersort[i];
            var secondopinion = {};

            if( acq[_acq] ){
               newacq[_acq] = 1; // replace '1' with the costs.
               var objlength = Object.getOwnPropertyNames(newacq).length;

               if ( cardsCovered(newacq, settings) ) { break; }
               else if ((newacq.nets && objlength < 2) || (objlength === 0)) { continue; }
               else if ( i+1 == settings.acquirersort.length ) { newacq = false; break; }
               else { delete newacq[_acq]; } // Delete and try with next acquirer
            }
         }

         if (psp.features.multiacquirer) {
         // Challenge newacq ( coming soon! )
         }

         // Skip PSP if acquirer does not support cards
         if ( Object.getOwnPropertyNames(newacq).length === 0) { continue psploop; }
         acq = newacq;


         for (var ac in acq) {
            // Merge acquirer card lists
            for (var card in acquirers[ac].cards ) {

               // Some cards/methods (e.g. mobilepay) add extra costs.
               // They will only be included if enabled in settings.cards.
               if ( cardobj[card] || (!settings.cards[card] && CARDs[card].costfn) ){ continue; }

               if (CARDs[card].costfn){
                  setup = setup.add(CARDs[card].fee.setup);
                  recurring = recurring.add(CARDs[card].fee.monthly);
               }
               cardobj[card] = 1;
            }

            var scale = (ac == "nets") ? settings.dankort_scale :  1-settings.dankort_scale;

            setup = setup.add(acquirers[ac].fee_setup);
            recurring = recurring.add( acquirers[ac].fee_monthly);
            total = total.add( acquirers[ac].fee.trans.scale(scale));
         }
      }

      psp.costs = psp.costfn(settings);

      setup = setup.add(psp.costs.setup);
      recurring = recurring.add(psp.costs.monthly);
      total = total.add(psp.costs.trans).add(recurring);

      var cardfrag = document.createDocumentFragment();
      var wrapper, svg, use;

      for (l in cardobj) {
         wrapper = document.createElement("p");
         wrapper.classList.add("card");
         // wrapper.addEventListener("mouseover", tooltip);
         // el.addEventListener("click", function(){modifyText("four")}, false);
         svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
         use = document.createElementNS("http://www.w3.org/2000/svg",'use');
         use.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", CARDs[l].logo);
         use.setAttribute('x','0');
         use.setAttribute('y','0');
         use.setAttribute('height','15');
         svg.appendChild(use);
         wrapper.appendChild(svg);
         cardfrag.appendChild(wrapper);
      }

      var more = document.createElement("p");
      var rand = Math.floor(Math.random() * 6) + 1;
      more.innerHTML = "<a href='#'>"+ rand + "</a>";
      // cardfrag.appendChild(more);

      var acqfrag = document.createDocumentFragment();
      for (l in acq) {
         wrapper = document.createElement("p");
         wrapper.className = "acquirer";
         //wrapper.addEventListener("mouseover", tooltip);

         wrapper.innerHTML = '<a target="_blank" href="' + ACQs[l].link + '"><img class="acquirer '+l+'" src="/assets/img/psp/' + ACQs[l].logo + '" alt="' + ACQs[l].name +
         '" title="' + ACQs[l].name + '" /></a>';
         acqfrag.appendChild(wrapper);
      }

      // Sort psp after total.dkk()
      for (sort = 0; sort < data.length; ++sort) {
         if (total.dkk() < data[sort]) { break; }
      }
      data.splice(sort, 0, total.dkk());

      var row = tbody.insertRow(sort);
      row.insertCell(-1).innerHTML = '<a target="_blank" class="psp '+ psp.name.substring(0,4).toLowerCase() +'" href=' + psp.link + '><img src="/assets/img/psp/' + psp.logo + '" alt="' + psp.name +
         '" title="' + psp.name +'" /><p>' + psp.name +'</p></a>';
      row.insertCell(-1).appendChild(acqfrag);
      row.insertCell(-1).appendChild(cardfrag);
      row.insertCell(-1).textContent = setup.print();
      row.insertCell(-1).textContent = recurring.print();
      row.insertCell(-1).textContent = total.print();

      var kortgebyr = total.scale(1 / settings.transactions);
      var kortprocent = kortgebyr.scale( 1/settings.avgvalue.dkk()).dkk()*100;

      row.insertCell(-1).innerHTML = "<p class='kortgebyr'>"+total.scale(1 / settings.transactions).print() + "</p><p class='procent'>≈ " + kortprocent.toFixed(3).replace('.', ',') + " %</p>";

      var infoButton = document.createElement("div");
      infoButton.classList.add("infobutton");
      /* construct acq list */
      infoButton.addEventListener("click", klik(psp, acquirers, acq, settings));

      infoButton.textContent = "Se mere";
      row.insertCell(-1).appendChild(infoButton);
   }
   table.replaceChild(tbody, $('tbody'));

   if (action !== "init") { saveurl(); }

   console.log( (performance.now()-stopwatch).toFixed(3) +"ms ::: done building \n ");

}

//===========================
//            Modal
//===========================

function buildInfoModal(psp, acquirers, acqlabels, settings) {
   var overlay = document.querySelector(".overlay.pspinfo");
   var content = overlay.getElementsByClassName("content")[0];
   var frag = document.createDocumentFragment();
   console.log(acqlabels);
   content.innerHTML = "";
   /*var h = document.createElement("h1");
   frag.appendChild(h).textContent = "Oversigt over " + psp.name;*/

   var psptitle = document.createElement("h3");
   frag.appendChild(psptitle).textContent = "Omkostninger til payment gateway:";

   var psph = document.createElement("h4");
   var pspBlock = document.createElement("div");
   var pspSetup = document.createElement("div");
   var pspMonthly = document.createElement("div");
   var pspTrans = document.createElement("div");

   pspBlock.classList.add("costblock");

   pspBlock.appendChild(psph).textContent = psp.name + ":";
   pspBlock.appendChild(pspSetup).textContent = "Oprettelse: " + psp.costs.setup.print();
   pspBlock.appendChild(pspMonthly).textContent = "Abonnement per måned: " + psp.costs.monthly.print();
   pspBlock.appendChild(pspTrans).textContent = "Transaktionsgebyrer: " + psp.costs.trans.print();
   frag.appendChild(pspBlock);

   if (Object.keys(acqlabels).length > 0) {
      frag.appendChild(document.createElement("hr"));
      var acqtitle = document.createElement("h3");
      frag.appendChild(acqtitle).textContent = "Indløseromkostninger:";
      if (acqlabels.nets && Object.keys(acqlabels).length > 1) {
         var acqdescription = document.createElement("div");
         frag.appendChild(acqdescription).textContent = "Det antages jævnfør FDIH's statistikker at Nets modtager 77% af transaktionerne (fra visa/dankort samt rene dankort), mens den sekundære indløser modtager 33%.";
      }
   }
   for (var label in acqlabels) {
      var acq = acquirers[label];
      var acqblock = document.createElement("div");
      var acqh = document.createElement("h4");

      var acqSetup = document.createElement("div");
      var acqMonthly = document.createElement("div");
      var acqTrans = document.createElement("div");

      acqblock.classList.add("costblock");

      acqblock.appendChild(acqh).textContent = acq.name + ":";
      acqblock.appendChild(acqSetup).textContent = "Oprettelse: " + acq.fee_setup.print();
      acqblock.appendChild(acqMonthly).textContent = "Abonnement per måned: " + acq.fee_monthly.print();
      var scale = (label === "nets") ? settings.dankort_scale : 1 - settings.dankort_scale;
      acqblock.appendChild(acqTrans).textContent = "Transaktionsgebyrer: " + acq.fee.trans.scale(scale).print();
      frag.appendChild(acqblock);
   }

   if (settings.cards.mobilepay) {
      var mpayblock = document.createElement("div");
      var mpayh = document.createElement("h4");
      var mpaySetup = document.createElement("div");
      var mpayMonthly = document.createElement("div");
      var mpayTrans = document.createElement("div");
      mpayblock.classList.add("costblock");
      mpayblock.appendChild(mpayh).textContent = "Extra til Mobilepay oven i indløseromkostninger:";
      mpayblock.appendChild(mpaySetup).textContent = "Oprettelse: " + settings.cards.mobilepay.fee.setup.print();
      mpayblock.appendChild(mpayMonthly).textContent = "Abonnement per måned: " + settings.cards.mobilepay.fee.monthly.print();
      mpayblock.appendChild(mpayTrans).textContent = "Transaktionsgebyrer: 1kr ekstra pr. mobilepay transaktion";
      frag.appendChild(mpayblock);
   }

   content.appendChild(frag);
   overlay.classList.add("active");
}

document.onkeydown = function(e) {
   e = e || window.event;
   if ((e.keyCode || e.which) === 27) {
      var containers = document.querySelectorAll('.overlay.active');
      for (var i in containers) {
         if (!isNaN(i)) {
            containers[i].classList.remove('active');
         }
      }
   }
};



//===========================
//            URL
//===========================

var base64_chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/";

function Base64Array(initsize) {
    this.bitpos = 0; // from 0 - 5
    this.array = [];
    this.pos = 0;
}

Base64Array.prototype.pushbit = function(bit) {
    if (this.array.length === 0) {this.array.push(0);}
    if (this.bitpos > 5) {
        this.bitpos = 0;
        this.array.push(0);
    }
    this.array[this.array.length - 1] += bit << this.bitpos;
    this.bitpos++;
};

Base64Array.prototype.getbit = function() {
    if (this.bitpos > 5) {
        this.bitpos = 0;
        this.pos++;
    }
    var bitval = (this.array[this.pos] & (1 << this.bitpos)) >>> this.bitpos;
    this.bitpos++;
    return bitval;
};

Base64Array.prototype.pushbits = function(bitval, nbits) {
    for(var i = 0; i < nbits; i++) {
        this.pushbit((bitval & (1 << i)) >>> i);
    }
};

Base64Array.prototype.encode = function() {
    var encstr = "";
    for (var i = 0; i < this.array.length; i++) {
        console.log("arr[" + i + "] = " + this.array[i]);
        encstr += base64_chars[this.array[i]];
    }
    return encstr;
};

Base64Array.prototype.pushbase64char = function(b64char) {
    var index = base64_chars.indexOf(b64char);
    if (index < 0) {
        console.log("Unexpected query character " + b64char);
        return -1;
    }
    this.array.push(index);
    return 0;
};

Base64Array.prototype.getbits = function(nbits) {
    var val = 0;
    for (var i = 0; i < nbits; i++) {
        val += this.getbit() << i;
    }
    return val;
};


/* Save the url to the following structure URL = kortgebyr.dk?{BITS}{ARGUMENT STRING}*/
function saveurl() {
    var argstr = ""; // The optional arguments string which follows the base64 enc. bits
    var nbits; // the number of bits for the current option
    var optbits; // The bits for the current option
    var bitbuf = new Base64Array(); // The buffer used for containing bits until they are flushed
    var o;

    /* Loop through the options and construct the url */
    for (var key in opts) {
        o = opts[key];

        /* Depending on whether dirty bits are used or not, react accordingly */
        if (o.dirty_bits) {
            nbits = o.dirty_bits;
            optbits = o.get_dirty_bits("url");
            var ret = o.get();
            /* Create the argument string part if dirty bit is set */
            if (optbits) {
                if (ret instanceof Currency) {
                    argstr += ";" + ret.string();
                } else {
                    argstr += ";" + ret;
                }
            }

        } else if (o.bits) {
            nbits = typeof(o.bits) === "function" ? o.bits() : o.bits;
            optbits = o.get("url");
        } else {
            console.log("opt " + key + " neither has a bits field or a dirty_bits field");
            return;
        }
        bitbuf.pushbits(optbits, nbits);
    }


    history.replaceState({
       foo: "bar"
    }, "", "?" + bitbuf.encode() + argstr);
}

function loadurl() {
    var querystring = location.search.replace("?", "");
    if (!querystring) { return; }

    var encbits = ""; // The base64 encoded bits
    var args; // The optional arguments string which follows the base64 enc. bits
    var nbits; // the number of bits for the current option
    var bitval;
    var bitbuf = new Base64Array(); // The buffer used for containing bits until they are flushed
    var o;

    /* Check if any additional args after the bits and
       create the arg array if that is the case */
    var nb64chars = querystring.indexOf(";");
    if (nb64chars < 0) {
        nb64chars = querystring.length;
    } else {
        args = querystring.slice(nb64chars + 1).split(";");
    }

    /* Load the base64 representation of the bits into a base64array type */
    for (var i = 0; i < nb64chars; i++) {
        if (bitbuf.pushbase64char(querystring[i]) !== 0) {
            console.log("error parsing bits");
            return -1;
        }
    }

    /* Loop through the opts set the fields with values loaded from the url */
    for (var key in opts) {
        o = opts[key];
        /* Check if opt has dirty bits, if so load arg */
        if (o.dirty_bits) {
            nbits = o.dirty_bits;
            bitval = bitbuf.getbits(nbits);
            if (bitval > 0) {
                o.set(args[0]);
                args.shift();
            }
        /* Otherwise just load the bits directly */
        } else if (o.bits){
            nbits = typeof(o.bits) === "function" ? o.bits() : o.bits;
            bitval = bitbuf.getbits(nbits);
            o.set(bitval);
        } else {
            console.log("opt " + key + " neither has a bits field or a dirty_bits field");
            return;
        }
        /* Create the argument string part if dirty bit is set */
    }
}

build('init');
</script>
</body></html>
